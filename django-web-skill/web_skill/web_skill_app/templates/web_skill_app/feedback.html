{% extends 'web_skill_app/base.html' %}
{% load static %}

{% block title %}Danos tu Opinión - Soft Agents{% endblock %}

{% block content %}
    {% include 'web_skill_app/partials/navigation.html' with currentPage='feedback' %}

    <div class="min-h-screen pt-16 bg-slate-900 flex items-center justify-center p-4 relative overflow-hidden">
        
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-600/20 rounded-full blur-[100px] animate-pulse"></div>
        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-pink-600/20 rounded-full blur-[100px] animate-pulse" style="animation-delay: 1s;"></div>

        <div class="relative w-full max-w-lg bg-slate-800/60 backdrop-blur-xl border border-purple-500/30 rounded-2xl shadow-2xl overflow-hidden animate-fadeIn z-10">
            
            <div class="p-8 text-center border-b border-purple-500/20 bg-slate-800/50">
                <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center shadow-lg shadow-purple-500/30">
                    <span class="text-3xl">⭐</span>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">Tu opinión nos importa</h2>
                <p class="text-slate-400 text-sm">Ayúdanos a mejorar Soft Agents calificando tu experiencia.</p>
            </div>

            <form action="{% url 'guardar_feedback' %}" method="POST" class="p-8 space-y-6" id="feedbackForm">
                {% csrf_token %}
                
                <div class="flex flex-col items-center space-y-3">
                    <label class="text-slate-300 font-medium text-sm">¿Cómo calificarías la aplicación?</label>
                    
                    <div class="flex gap-2 group" id="starContainer">
                        <input type="hidden" name="rating" id="ratingInput" required>
                        
                        {% for i in "12345" %}
                        <button type="button" class="star-btn transition-transform hover:scale-110 focus:outline-none" data-value="{{ i }}">
                            <svg class="w-10 h-10 text-slate-600 transition-colors duration-200" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                            </svg>
                        </button>
                        {% endfor %}
                    </div>
                    <p class="text-purple-400 text-sm h-5 font-semibold" id="ratingText"></p>
                </div>

                <div class="space-y-2">
                    <label for="comments" class="text-slate-300 font-medium text-sm ml-1">Tus comentarios o sugerencias</label>
                    <textarea 
                        name="comments" 
                        id="comments" 
                        rows="4" 
                        class="w-full bg-slate-900/50 border border-slate-600 rounded-xl p-4 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all resize-none"
                        placeholder="¿Qué te gustó más? ¿Qué podemos mejorar?"
                        required
                    ></textarea>
                </div>

                <div class="flex gap-4 pt-2">
                    <a href="{% url 'dashboard' %}" class="flex-1 py-3 text-center text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-xl transition-all border border-transparent hover:border-slate-600">
                        Cancelar
                    </a>
                    <button type="submit" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-xl shadow-lg shadow-purple-900/30 hover:shadow-purple-500/40 hover:-translate-y-0.5 transition-all duration-300">
                        Enviar Opinión
                    </button>
                </div>
            </form>
        </div>
    </div>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        
        /* Clase para estrellas activas (doradas/amarillas) */
        .star-active { color: #fbbf24; filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.5)); }
    </style>

    <script>
        const stars = document.querySelectorAll('.star-btn');
        const ratingInput = document.getElementById('ratingInput');
        const ratingText = document.getElementById('ratingText');
        const labels = ["Malo", "Regular", "Bueno", "Muy Bueno", "¡Excelente!"];

        stars.forEach((star, index) => {
            // Hover
            star.addEventListener('mouseenter', () => {
                highlightStars(index + 1);
                ratingText.textContent = labels[index];
            });

            // Click
            star.addEventListener('click', () => {
                ratingInput.value = index + 1;
                highlightStars(index + 1);
                // Añadir animación de pulso al seleccionar
                star.classList.add('scale-125');
                setTimeout(() => star.classList.remove('scale-125'), 200);
            });
        });

        // Reset al salir del contenedor (si no hay selección)
        document.getElementById('starContainer').addEventListener('mouseleave', () => {
            const currentRating = ratingInput.value;
            if (currentRating) {
                highlightStars(currentRating);
                ratingText.textContent = labels[currentRating - 1];
            } else {
                highlightStars(0);
                ratingText.textContent = "";
            }
        });

        function highlightStars(count) {
            stars.forEach((s, i) => {
                const svg = s.querySelector('svg');
                if (i < count) {
                    svg.classList.add('star-active', 'text-yellow-400');
                    svg.classList.remove('text-slate-600');
                } else {
                    svg.classList.remove('star-active', 'text-yellow-400');
                    svg.classList.add('text-slate-600');
                }
            });
        }
    </script>
{% endblock %}